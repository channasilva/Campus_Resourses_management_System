<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timezone Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-result {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .test-error {
            background: #ffebee;
            border: 1px solid #f44336;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976d2;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üïí Timezone Fix Test</h1>
    <p>This page tests the timezone handling fix for the booking system.</p>

    <div class="test-container">
        <h2>Test Time Input</h2>
        <div>
            <label>Date: <input type="date" id="testDate" value="2025-12-20"></label>
            <label>Start Time: <input type="time" id="startTime" value="08:00"></label>
            <label>End Time: <input type="time" id="endTime" value="12:30"></label>
        </div>
        <button onclick="testTimezoneHandling()">Test Timezone Handling</button>
        <div id="testResults"></div>
    </div>

    <div class="test-container">
        <h2>Test Display Functions</h2>
        <button onclick="testDisplayFunctions()">Test Display Functions</button>
        <div id="displayResults"></div>
    </div>

    <script>
        // Replicate the fixed date utility functions
        function createLocalDateTime(dateString, timeString) {
            const [year, month, day] = dateString.split('-').map(Number);
            const [hours, minutes] = timeString.split(':').map(Number);
            
            const date = new Date(year, month - 1, day, hours, minutes, 0, 0);
            
            if (isNaN(date.getTime())) {
                throw new Error('Invalid date or time format');
            }
            
            return date;
        }

        function toLocalISOString(localDate) {
            const year = localDate.getFullYear();
            const month = String(localDate.getMonth() + 1).padStart(2, '0');
            const day = String(localDate.getDate()).padStart(2, '0');
            const hours = String(localDate.getHours()).padStart(2, '0');
            const minutes = String(localDate.getMinutes()).padStart(2, '0');
            const seconds = String(localDate.getSeconds()).padStart(2, '0');
            
            return `${year}-${month}-${day}T${hours}:${minutes}:${seconds}.000Z`;
        }

        function formatLocalTime(dateString) {
            const date = new Date(dateString);
            
            if (dateString.endsWith('Z')) {
                return date.toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: true 
                });
            }
            
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            
            return `${displayHours}:${minutes.toString().padStart(2, '0')} ${ampm}`;
        }

        function formatLocalDateTime(dateString) {
            const date = new Date(dateString);
            
            if (dateString.endsWith('Z')) {
                return date.toLocaleString([], {
                    year: 'numeric',
                    month: 'numeric',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
            }
            
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            
            return `${month}/${day}/${year}, ${displayHours}:${minutes.toString().padStart(2, '0')} ${ampm}`;
        }

        function testTimezoneHandling() {
            const testDate = document.getElementById('testDate').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            const resultsDiv = document.getElementById('testResults');
            
            try {
                console.log('üß™ Testing timezone handling...');
                console.log('Input:', { testDate, startTime, endTime });
                
                // Test the fixed functions
                const startDateTime = createLocalDateTime(testDate, startTime);
                const endDateTime = createLocalDateTime(testDate, endTime);
                
                console.log('Created date objects:', {
                    startDateTime: startDateTime.toString(),
                    endDateTime: endDateTime.toString(),
                    startHours: startDateTime.getHours(),
                    startMinutes: startDateTime.getMinutes(),
                    endHours: endDateTime.getHours(),
                    endMinutes: endDateTime.getMinutes()
                });
                
                const startTimeISO = toLocalISOString(startDateTime);
                const endTimeISO = toLocalISOString(endDateTime);
                
                console.log('ISO strings:', { startTimeISO, endTimeISO });
                
                const startTimeFormatted = formatLocalDateTime(startTimeISO);
                const endTimeFormatted = formatLocalDateTime(endTimeISO);
                
                console.log('Formatted times:', { startTimeFormatted, endTimeFormatted });
                
                // Check if times match input
                const startMatches = startDateTime.getHours() === parseInt(startTime.split(':')[0]) && 
                                   startDateTime.getMinutes() === parseInt(startTime.split(':')[1]);
                const endMatches = endDateTime.getHours() === parseInt(endTime.split(':')[0]) && 
                                 endDateTime.getMinutes() === parseInt(endTime.split(':')[1]);
                
                const success = startMatches && endMatches;
                
                resultsDiv.innerHTML = `
                    <div class="test-result">
                        <h3>‚úÖ Test Results</h3>
                        <p><strong>Input Times:</strong> ${startTime} - ${endTime}</p>
                        <p><strong>Created Date Objects:</strong></p>
                        <ul>
                            <li>Start: ${startDateTime.toString()} (${startDateTime.getHours()}:${startDateTime.getMinutes().toString().padStart(2, '0')})</li>
                            <li>End: ${endDateTime.toString()} (${endDateTime.getHours()}:${endDateTime.getMinutes().toString().padStart(2, '0')})</li>
                        </ul>
                        <p><strong>ISO Strings for Storage:</strong></p>
                        <ul>
                            <li>Start: ${startTimeISO}</li>
                            <li>End: ${endTimeISO}</li>
                        </ul>
                        <p><strong>Formatted Display:</strong></p>
                        <ul>
                            <li>Start: ${startTimeFormatted}</li>
                            <li>End: ${endTimeFormatted}</li>
                        </ul>
                        <p><strong>Time Match Check:</strong> ${startMatches ? '‚úÖ' : '‚ùå'} Start Time, ${endMatches ? '‚úÖ' : '‚ùå'} End Time</p>
                        <p><strong>Overall Result:</strong> ${success ? '‚úÖ SUCCESS - Times preserved correctly!' : '‚ùå FAILED - Times were shifted'}</p>
                    </div>
                `;
                
            } catch (error) {
                console.error('Test error:', error);
                resultsDiv.innerHTML = `
                    <div class="test-error">
                        <h3>‚ùå Test Error</h3>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        function testDisplayFunctions() {
            const resultsDiv = document.getElementById('displayResults');
            
            // Test with various time formats
            const testTimes = [
                '2025-12-20T08:00:00.000Z',
                '2025-12-20T12:30:00.000Z',
                '2025-12-20T14:15:00.000Z',
                '2025-12-20T23:45:00.000Z'
            ];
            
            let results = '<div class="test-result"><h3>‚úÖ Display Function Test Results</h3>';
            
            testTimes.forEach(timeStr => {
                try {
                    const timeFormatted = formatLocalTime(timeStr);
                    const dateTimeFormatted = formatLocalDateTime(timeStr);
                    
                    results += `
                        <p><strong>Input:</strong> ${timeStr}</p>
                        <p><strong>Time Only:</strong> ${timeFormatted}</p>
                        <p><strong>Date & Time:</strong> ${dateTimeFormatted}</p>
                        <hr>
                    `;
                } catch (error) {
                    results += `<p><strong>Error with ${timeStr}:</strong> ${error.message}</p>`;
                }
            });
            
            results += '</div>';
            resultsDiv.innerHTML = results;
        }

        // Auto-run test on page load
        window.onload = function() {
            console.log('üïí Timezone Fix Test Page Loaded');
            console.log('Current timezone offset:', new Date().getTimezoneOffset(), 'minutes');
            console.log('Current time:', new Date().toString());
        };
    </script>
</body>
</html>